---
title:  "Chap 4. SQL 정렬과 연산" 
excerpt: "내가 널 인지한 순간 넌 ,, 글자에서 정보가 됐어!"

categories:
  - SQL
tags:
  - [Database, SQL]

toc: true
toc_sticky: true
 
date: 2022-10-12
last_modified_at: 2022-10-13

---

### 정렬

SELECT 명령에 ORDER BY 구를 지정하면 출력 결과의 행 순서를 정렬할 수 있다. 이때 DB 내부에 저장된 순서에는 영향이 미치지 않고 오직 출력 결과의 순서에 영향을 미친다. 

#### ORDER BY 정렬

```SQL
SELECT [열이름] FROM [테이블명] (WHERE [조건식]) ORDER BY [열이름];
```

기본식이다. ORDER BY 구에 정렬의 기준이 되는 열을 입력하면 기본적으로 **오름차순**으로 출력이된다. 

#### ORDER BY 내림차순 정렬

```SQL
SELECT ~~ (중략) ~~ ORDER BY [열이름] DESC;
```

기본적으로 `ASC`이 입력되어 있지만 내림차순 정렬을 원한다면 `DESC`를 열이름 뒤에 입력한다. 

#### 대소관계

수치형 데이터는 오름차순, 내림차순 정렬을 이해하기 간단하다. 숫자가 커질지는 순서로 '오름차순', 높은 수에서 낮은 수로 정렬되는 '내림차순'.  

문자열형 데이터는 우리가 아는 알파벳 순서, 한글 자모음 배열 순서로 오름차순이다. 즉, 사전식 순서게 의해 결정된다. 

⭐이때 중요한건 우리 눈으로는 수치형으로 보일 수 있지만! 사실은 문자열형일때 정렬이 사전식으로 된다는 것이다. 숫자가 문자열형일 땐 (1, 10, 11, 2, 20, 3) 이런 식으로 정렬이 된다. 

### 복수 열 기준 정렬하기. 

```SQL
SELECT [열이름] FROM [테이블명] (WHERE [조건식]) 
ORDER BY [열이름1] ASC, [열이름2] DESC;
```

원하는 출력값을 위해 정렬을 쓰지만 하나의 열 기준에 동일 값이 존재할 수도 있기 때문에 보통 복수의 열 기준을 사용한다. 첫 정렬 기준에서 동일 값들 기준으로 두번째 정렬, 그 이상의 정렬을 하기 위한 식이 위의 식이다. 

이때 위와 같이 열 기준마다 오름차순, 내림차순을 설정할 수 있다. 그리고 열 기준은 앞에 쓴 것 부터 우선 순위로 정렬된다. 

> NULL 값의 정렬 순서 
      
    NULL은 데이터가 없음 상태이므로 대소비교를 할 수 없다. 따라서 NULL값은 모든 행에서 가장 먼저 표시되거나 가장 뒤에 표시된다. 

    MySQL의 경우 NULL값은 가장 작은 값으로 취급해 ASC에서 가장 먼저 표시된다. 


### LIMIT 결과 행 출력 수 조절

```SQL
SELECT [열명] FROM [테이블명] LIMIT 행수 (OFFSET 시작행 번호);
```

LIMIT 구는 표준 SQL은 아니고 MySQL과 PostgreSQL에서만 사용할 수 있는 문법이다. 

우리는 DB의 모든 행을 확인하는데 한계가 있다. 의식적 한계 혹은 모니터의 한계 등으로. 따라서 적당히 필요한 행만 출력할 수 있도록 LIMIT을 건다고 보면 된다. 

#### 상위 몇 개 출력!
  
내가 원하는 데이터들에서 상위 5개만 보고싶다면 아래와 같이!

```SQL
SELECT ~ FROM ~ LIMIT 5;
```

이렇게 하면 된다. 유념해야할 것은 조건문을 통해 딱 5개만 추려질 수 있게 하는 것과는 다른 것이다. WHERE 조건문을 사용하면 전체 출력값이 딱 5개 인것이고 LIMIT 구는 수 십,백개의 행 중에 5개만 표시되는 것이다. 

ORACLE, SQL SERVER 등 여러가지 RDBMS는 각기 다른 결과 행 제한 구문이 있으니 필요할 때 찾아보자. 

#### 중간부터 몇 개 출력!

만일 6번째 행 부터 10번째 행까지 보고싶다면 아래와 같이!

```SQL
SELECT ~ FROM ~ LIMIT 5 OFFSET 5;
```

OFFSET은 시작 위치를 지정해주는 구문이다. 생략이 가능하고 생략한다면 기본값은 0이다. 위치가 0이라는건 Python과 같이 컴퓨터 자료구조 배열을 생각하면 된다. 때문에 6번째 시작이면 OFFSET 5가 맞다. 

---

### 수치 연산 

SQL을 통해 간단한 수식 혹은 함수를 이용할 수 있다. 

> 사칙 연산 

    다른 프로그래밍 언어처럼 사칙연산을 수행하면 된다. 연산자를 이용하면 된다. 

#### SELECT 구로 연산

SELECT 구는 열을 지정하는 구문이다. 하지만 단순히 테이블에 있는 열만 지정해서 출력하지 않는다. 테이블에 있는 열을 이용하여 계산한 식을 표시하거나 함수를 통한 결과를 표시해준다. 즉, SELECT을 통해 출력 표를 디자인한다 생각하면된다. 

```SQL
SELECT 열 1, 열 2, 열 1 + 열 2, 함수(열1, 열2, ...) FROM 테이블명;
```

위와 같이 코드를 입력하면 출력 테이블은 SELECT 문에 지정된 열과 계산 열 순서로 표시된다. 덤으로 각 행은 그에 맞는 계산을 수행하여 출력된다. 

#### 열 별명

SELECT 문으로 열을 계산하여 출력하면 테이블에 수식이 그대로 노출된다. 지저분하여 생산성을 저해하니 AS 구문으로 수식 열에 맞는 열 이름을 생성해준다. 

```SQL
SELECT *, 열 1 + 열 2 AS 별명 1 FROM 테이블명;
```

이처럼 해당 열 뒤에 AS 구문을 사용하면 된다. 이때 ASCII 문자 (영어, 숫자 등 1개 1 bite)가 아닌 것들은 더블쿼트("")로 둘러싸서 지정한다. 만일 ASCII여도 예약어라면 더블쿼트로 둘러싸야한다. (하지만 예약어는 다른 객체 이름으로 간주하지 못하는게 일반적이니 지양한다.)

> 더블쿼트로 둘러싸면 명령구문 상 DB 객체 이름이라 간주. 
> 싱글쿼트로 둘러싸는건 문자열 상수. 

별명은 'alias'라 불리며 숫자도 들어갈 수 있지만, 숫자가 별명의 시작일 수 없으면 숫자만으로 구성되면 안된다. 

#### WHERE 구에서 연산

```SQL
SELECT *, 열 1 + 열 2 AS 별명 1 FROM 테이블명
    WHERE 열 1 + 열 2 >= 30;
```

이처럼 자연스럽게 조건식 내에 필요한 열의 수식을 조합하여 필터링 할 수 있다. 

⭐ 이때 WHERE 구문에서 alias를 사용해도 되는가? **아니다** ' 별명 1 >= '이런식으로 조건식을 쓰면 안된다. 이유는 연산처리에 있어 WHERE 문이 SELECT 보다 먼저기 때문에 WHERE 문을 처리할 때는 별명 1이라는 것이 없기 때문이다. 

#### NULL 값 연산 

NULL 값 연산은 간단하다. 

> NULL값은 어떤 걸 계산해도 NULL 이다. 

다른 언어에서는  NULL이 0으로 처리하는 경우가 있어 연산이 가능하지만 SQL은 처리하지 못한다. NULL을 0으로 만들고 싶다면 CASE문 혹은 치환을 통해서 바꿔야 한다. 

#### ORDER BY 구에서 연산

ORDER BY 구문에서도 연산은 가능하다. 필요한 열을 통해 계산 수식을 만들고 이를 정렬 기준으로 삼으면 된다. 

```SQL
SELECT *, 열 1 + 열 2 AS 별명 1 FROM 테이블명
    WHERE 열 1 + 열 2 >= 30
    ORDER BY 열 1 + 열 2 DESC;
```

신기한건! ORDER BY 구에서는 SELECT 문에서 사용한 alias가 사용가능하다는 것이다.

> WHERE구 $\to$ SELECT 구 $\to$ ORDER BY 구

#### 함수 

```SQL
함수명 (인수1, 인수2, 인수3 ,,,)
```

굳이 많은것을 설명하지 않겠다. 필요한 함수는 다른 프로그래밍 언어처럼 SELECT문, WHERE문, ORDER BY문에 사용하면 된다. 

RDBMS 마다 사용하는 함수는 다르니 꼭 검색을 통해 잘 알아보자 ^^

수식에 필요한 집계 함수 등은 다음에 더 자세히 다루겠다. 

